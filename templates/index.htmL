<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Keylogger Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .status {
            text-align: center;
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.active {
            background-color: #d4edda;
            color: #155724;
        }
        .status.inactive {
            background-color: #f8d7da;
            color: #721c24;
        }
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        button {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .btn-start {
            background-color: #28a745;
            color: white;
        }
        .btn-start:hover {
            background-color: #218838;
        }
        .btn-stop {
            background-color: #dc3545;
            color: white;
        }
        .btn-stop:hover {
            background-color: #c82333;
        }
        .btn-show {
            background-color: #007bff;
            color: white;
        }
        .btn-show:hover {
            background-color: #0056b3;
        }
        .files-section {
            margin-top: 30px;
        }
        .file-list {
            display: none;
            margin-top: 20px;
        }
        .file-item {
            background-color: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .file-item:hover {
            background-color: #e9ecef;
        }
        .file-name {
            font-weight: bold;
            color: #333;
        }
        .file-details {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .file-content {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
            max-height: 600px;
            overflow-y: auto;
        }
        .content-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #dee2e6;
        }
        .tab {
            padding: 10px 20px;
            background-color: #e9ecef;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background-color: #007bff;
            color: white;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .reconstructed-text {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            line-height: 1.6;
            white-space: pre-wrap;
            word-wrap: break-word;
            border: 1px solid #dee2e6;
            max-height: 400px;
            overflow-y: auto;
        }
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .analytics-card {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }
        .analytics-card h4 {
            margin-top: 0;
            color: #007bff;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #28a745;
        }
        .word-frequency {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .word-tag {
            background-color: #e9ecef;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        .special-keys {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
        }
        .special-key-item {
            text-align: center;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 8px;
            background-color: white;
            border-radius: 3px;
            font-family: monospace;
            font-size: 14px;
        }
        .log-timestamp {
            color: #666;
            font-size: 12px;
        }
        .log-key {
            color: #007bff;
            font-weight: bold;
        }
        .back-button {
            margin-bottom: 10px;
            background-color: #6c757d;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .back-button:hover {
            background-color: #5a6268;
        }
        .message {
            text-align: center;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .message.success {
            background-color: #d4edda;
            color: #155724;
        }
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Personal Keylogger Dashboard</h1>
        
        <div id="status" class="status inactive">
            Status: Inactive
        </div>
        
        <div class="controls">
            <button id="startBtn" class="btn-start">Start</button>
            <button id="stopBtn" class="btn-stop">Stop</button>
            <button id="showBtn" class="btn-show">Show Files</button>
        </div>
        
        <div id="message" class="message" style="display: none;"></div>
        
        <div class="files-section">
            <div id="fileList" class="file-list"></div>
            <div id="fileContent" class="file-content"></div>
        </div>
    </div>

    <script>
        let isActive = false;
        let currentFile = null;

        // DOM elements
        const statusEl = document.getElementById('status');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const showBtn = document.getElementById('showBtn');
        const messageEl = document.getElementById('message');
        const fileListEl = document.getElementById('fileList');
        const fileContentEl = document.getElementById('fileContent');

        // Update status
        function updateStatus() {
            fetch('/status')
                .then(response => response.json())
                .then(data => {
                    isActive = data.active;
                    if (isActive) {
                        statusEl.textContent = `Status: Active (${data.current_file || 'Unknown file'})`;
                        statusEl.className = 'status active';
                    } else {
                        statusEl.textContent = 'Status: Inactive';
                        statusEl.className = 'status inactive';
                    }
                });
        }

        // Show message
        function showMessage(text, type = 'success') {
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 3000);
        }

        // Start keylogger
        startBtn.addEventListener('click', () => {
            fetch('/start', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    showMessage(data.message, data.status === 'started' ? 'success' : 'error');
                    updateStatus();
                });
        });

        // Stop keylogger
        stopBtn.addEventListener('click', () => {
            fetch('/stop', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    showMessage(data.message, data.status === 'stopped' ? 'success' : 'error');
                    updateStatus();
                });
        });

        // Show files
        showBtn.addEventListener('click', () => {
            fetch('/files')
                .then(response => response.json())
                .then(data => {
                    if (data.files) {
                        displayFiles(data.files);
                    } else {
                        showMessage('Error loading files', 'error');
                    }
                });
        });

        // Display files
        function displayFiles(files) {
            fileContentEl.style.display = 'none';
            fileListEl.innerHTML = '';
            
            if (files.length === 0) {
                fileListEl.innerHTML = '<p>No log files found.</p>';
            } else {
                files.forEach(file => {
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <div class="file-name">${file.name}</div>
                        <div class="file-details">
                            Size: ${(file.size / 1024).toFixed(2)} KB | 
                            Modified: ${file.modified}
                        </div>
                    `;
                    fileItem.addEventListener('click', () => viewFile(file.name));
                    fileListEl.appendChild(fileItem);
                });
            }
            
            fileListEl.style.display = 'block';
        }

        // View file content
        function viewFile(filename) {
            fetch(`/view/${filename}`)
                .then(response => response.json())
                .then(data => {
                    if (data.entries && data.processed) {
                        displayFileContent(filename, data.entries, data.processed);
                    } else {
                        showMessage('Error loading file content', 'error');
                    }
                });
        }

        // Display file content
        function displayFileContent(filename, entries, processed) {
            fileListEl.style.display = 'none';
            
            let content = `<button class="back-button" onclick="goBack()">← Back to Files</button>`;
            content += `<h3>Analysis of ${filename}</h3>`;
            
            // Create tabs
            content += `
                <div class="content-tabs">
                    <button class="tab active" onclick="showTab('reconstructed')">Reconstructed Text</button>
                    <button class="tab" onclick="showTab('analytics')">Analytics</button>
                    <button class="tab" onclick="showTab('raw')">Raw Data</button>
                </div>
            `;
            
            // Reconstructed text tab
            content += `
                <div id="reconstructed" class="tab-content active">
                    <h4>What you typed:</h4>
                    <div class="reconstructed-text">${escapeHtml(processed.reconstructed_text)}</div>
                </div>
            `;
            
            // Analytics tab
            content += `
                <div id="analytics" class="tab-content">
                    <div class="analytics-grid">
                        <div class="analytics-card">
                            <h4>Session Overview</h4>
                            <p>Duration: <span class="stat-number">${processed.analytics.session_duration}</span></p>
                            <p>Total Keys: <span class="stat-number">${processed.analytics.total_keys}</span></p>
                            <p>Characters: <span class="stat-number">${processed.analytics.total_characters}</span></p>
                            <p>Words: <span class="stat-number">${processed.analytics.total_words}</span></p>
                        </div>
                        
                        <div class="analytics-card">
                            <h4>Most Used Words</h4>
                            <div class="word-frequency">
                                ${Object.entries(processed.analytics.most_used_words).map(([word, count]) => 
                                    `<span class="word-tag">${word} (${count})</span>`
                                ).join('')}
                            </div>
                        </div>
                        
                        <div class="analytics-card">
                            <h4>Special Keys</h4>
                            <div class="special-keys">
                                ${Object.entries(processed.analytics.special_keys).map(([key, count]) => 
                                    `<div class="special-key-item"><strong>${key}</strong><br>${count}</div>`
                                ).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Raw data tab
            content += `
                <div id="raw" class="tab-content">
                    <h4>Raw Keylog Data (${entries.length} entries)</h4>
                    <div style="max-height: 400px; overflow-y: auto;">
            `;
            
            entries.forEach(entry => {
                const keyDisplay = entry.type === 'character' ? entry.key : entry.key.replace('Key.', '');
                content += `
                    <div class="log-entry">
                        <span class="log-timestamp">${entry.timestamp}</span> - 
                        <span class="log-key">${keyDisplay}</span>
                        <span style="color: #666; font-size: 12px;">(${entry.type})</span>
                    </div>
                `;
            });
            
            content += `
                    </div>
                </div>
            `;
            
            fileContentEl.innerHTML = content;
            fileContentEl.style.display = 'block';
        }

        // Show tab function
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
        }

        // Escape HTML function
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Go back to file list
        function goBack() {
            fileContentEl.style.display = 'none';
            fileListEl.style.display = 'block';
        }

        // Initial status update
        updateStatus();
        
        // Update status every 5 seconds
        setInterval(updateStatus, 5000);
    </script>
</body>
</html>